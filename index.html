<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Sudoku de Cores</title>
  <style>
    body {
      font-family: sans-serif;
      background-color: #f0f0f0;
      color: #000;
      text-align: center;
      padding: 20px;
      transition: background-color 0.3s, color 0.3s;
    }
    body.dark-mode {
      background-color: #121212;
      color: #fff;
    }
    h1 { margin-bottom: 10px; }

    .board {
      display: grid;
      grid-template-columns: repeat(6, 60px);
      gap: 10px;
      justify-content: center;
      margin-bottom: 30px;
    }
    .cell {
      width: 60px;
      height: 60px;
      background-color: #fff;
      border: 2px solid #999;
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .palette {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 20px;
      min-height: 44px; /* mantém área de drop mesmo quando vazia */
      align-items: center;
    }
    .ball {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      cursor: grab;
      border: 2px solid #555;
    }

    .message {
      margin-top: 10px;
      font-weight: bold;
      color: green;
    }

    .button {
      margin-top: 10px;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
    }

    #instructions {
      background-color: #fff;
      border: 2px solid #ccc;
      padding: 20px;
      max-width: 500px;
      margin: 0 auto 30px auto;
      text-align: left;
      border-radius: 10px;
    }
    body.dark-mode #instructions {
      background-color: #1e1e1e;
      border-color: #555;
    }
  </style>
</head>
<body>
  <h1 id="game-title">Sudoku de Cores</h1>
  <div>
    <label for="lang-select" id="label-language">Idioma:</label>
    <select id="lang-select" onchange="mudarIdioma()">
      <option value="pt">Português</option>
      <option value="en">English</option>
      <option value="es">Español</option>
    </select>
    <button class="button" onclick="toggleModoNoturno()" id="btnToggleMode">Modo Escuro / Claro</button>
    <button class="button" onclick="mostrarInstrucoes()" style="display:none;" id="btnInstrucoes">Ver Instruções</button>
  </div>

  <div id="instructions">
    <h2 id="instructions-title">Como jogar:</h2>
    <ul id="instructions-list">
      <li></li>
      <li></li>
      <li></li>
      <li></li>
    </ul>
    <p id="instructions-goodluck">Boa sorte!</p>
    <button class="button" onclick="iniciarJogo()" id="btnStartGame">Iniciar Jogo</button>
  </div>

  <div class="board" id="board" style="display:none;"></div>
  <div class="palette" id="palette" style="display:none;"></div>
  <div class="message" id="message"></div>
  <button class="button" onclick="reiniciarJogo()" id="btnReiniciar" style="display:none;">Reiniciar Jogo</button>

  <audio id="sound-drop" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_c6b31dc3cb.mp3?filename=click-124467.mp3"></audio>
  <audio id="sound-win" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_1418bfa15b.mp3?filename=success-1-6297.mp3"></audio>

  <script>
    const translations = {
      pt: {
        title: "Sudoku de Cores",
        howToPlay: "Como jogar:",
        instructions: [
          "Arraste as bolinhas coloridas para os espaços do tabuleiro (3 linhas x 6 colunas).",
          "Você deve usar todas as bolinhas disponíveis: nenhuma cor pode se repetir na mesma linha ou coluna.",
          "Não pode haver bolinhas da mesma cor em casas adjacentes (nem mesmo nas diagonais).",
          "Você pode arrastar bolinhas de volta para a paleta ou substituir uma já colocada."
        ],
        goodLuck: "Boa sorte!",
        startGame: "Iniciar Jogo",
        seeInstructions: "Ver Instruções",
        restartGame: "Reiniciar Jogo",
        language: "Idioma:",
        toggleMode: "Modo Escuro / Claro",
        winMessage: "Parabéns! Você resolveu o puzzle!",
        errorMessage: "Tabuleiro preenchido, mas ainda há posições incorretas. Continue tentando!"
      },
      en: {
        title: "Color Sudoku",
        howToPlay: "How to Play:",
        instructions: [
          "Drag the colored balls to the board spaces (3 rows x 6 columns).",
          "You must use all available balls: no color may repeat in the same row or column.",
          "No same-colored balls should be in adjacent cells (not even diagonals).",
          "You can drag balls back to the palette or replace an existing one."
        ],
        goodLuck: "Good luck!",
        startGame: "Start Game",
        seeInstructions: "See Instructions",
        restartGame: "Restart Game",
        language: "Language:",
        toggleMode: "Dark / Light Mode",
        winMessage: "Congratulations! You solved the puzzle!",
        errorMessage: "Board is full, but there are still errors. Keep trying!"
      },
      es: {
        title: "Sudoku de Colores",
        howToPlay: "Cómo jugar:",
        instructions: [
          "Arrastra las bolitas de colores a los espacios del tablero (3 filas x 6 columnas).",
          "Debes usar todas las bolitas disponibles: ningún color puede repetirse en la misma fila o columna.",
          "No puede haber bolitas del mismo color en celdas adyacentes (ni siquiera en las diagonales).",
          "Puedes arrastrar bolitas de regreso a la paleta o reemplazar una ya colocada."
        ],
        goodLuck: "¡Buena suerte!",
        startGame: "Comenzar Juego",
        seeInstructions: "Ver Instrucciones",
        restartGame: "Reiniciar Juego",
        language: "Idioma:",
        toggleMode: "Modo Oscuro / Claro",
        winMessage: "¡Felicidades! ¡Has resuelto el rompecabezas!",
        errorMessage: "Tablero completo, pero aún hay errores. ¡Sigue intentando!"
      }
    };

    const board     = document.getElementById('board');
    const palette   = document.getElementById('palette');
    const messageEl = document.getElementById('message');
    const soundDrop = document.getElementById('sound-drop');
    const soundWin  = document.getElementById('sound-win');
    const cells     = [];
    const colors    = [
      { name: 'vermelho',    code: '#e74c3c', count: 3 },
      { name: 'amarelo',     code: '#f1c40f', count: 3 },
      { name: 'verde',       code: '#2ecc71', count: 3 },
      { name: 'azul-escuro', code: '#2980b9', count: 2 },
      { name: 'azul-claro',  code: '#5dade2', count: 2 },
      { name: 'rosa',        code: '#ff69b4', count: 2 },
      { name: 'branco',      code: '#ecf0f1', count: 3 }
    ];

    function criarTabuleiro() {
      board.innerHTML = '';
      cells.length = 0;
      for (let i = 0; i < 18; i++) {
        const cell = document.createElement('div');
        cell.className = 'cell';
        cell.dataset.index = i;
        cell.addEventListener('dragover', e => e.preventDefault());
        cell.addEventListener('drop', handleDrop);
        board.appendChild(cell);
        cells.push(cell);
      }
    }

    function criarPaleta() {
      palette.innerHTML = '';
      colors.forEach(color => {
        for (let i = 0; i < color.count; i++) {
          const ball = document.createElement('div');
          ball.className = 'ball';
          ball.style.backgroundColor = color.code;
          ball.setAttribute('draggable', true);
          ball.dataset.color = color.name;
          ball.dataset.id = `${color.name}-${i}`;
          ball.addEventListener('dragstart', handleDragStart);
          palette.appendChild(ball);
        }
      });
    }

    function handleDragStart(e) {
      e.dataTransfer.setData('id', e.target.dataset.id);
    }

    function handleDrop(e) {
      const target = e.target.closest('.cell');
      if (!target) return;
      const id   = e.dataTransfer.getData('id');
      const ball = document.querySelector(`.ball[data-id="${id}"]`);
      if (!ball) return;
      const existing = target.querySelector('.ball');
      if (existing) palette.appendChild(existing);

      const prev = ball.parentElement;
      if (prev.classList.contains('cell')) prev.innerHTML = '';

      target.appendChild(ball);
      soundDrop.play();
      checkWin();
    }

    palette.addEventListener('dragover', e => e.preventDefault());
    palette.addEventListener('drop', e => {
      e.preventDefault();
      const id   = e.dataTransfer.getData('id');
      const ball = document.querySelector(`.ball[data-id="${id}"]`);
      if (!ball) return;
      const prev = ball.parentElement;
      if (prev.classList.contains('cell')) prev.innerHTML = '';
      palette.appendChild(ball);
      soundDrop.play();
      checkWin();
    });

    function checkWin() {
      const lang = document.getElementById('lang-select').value;
      const t    = translations[lang];

      const grid = Array.from({ length: 3 }, () => Array(6).fill(null));
      cells.forEach((c, i) => {
        const r = Math.floor(i / 6), ci = i % 6;
        const b = c.querySelector('.ball');
        if (b) grid[r][ci] = b.dataset.color;
      });

      if (grid.flat().includes(null)) {
        messageEl.textContent = '';
        messageEl.style.color = '';
        return;
      }

      // validações...
      for (let i = 0; i < 3; i++) {
        const s = new Set();
        for (let j = 0; j < 6; j++) {
          if (s.has(grid[i][j])) {
            messageEl.textContent = t.errorMessage;
            messageEl.style.color = 'red';
            return;
          }
          s.add(grid[i][j]);
        }
      }
      for (let j = 0; j < 6; j++) {
        const s = new Set();
        for (let i = 0; i < 3; i++) {
          if (s.has(grid[i][j])) {
            messageEl.textContent = t.errorMessage;
            messageEl.style.color = 'red';
            return;
          }
          s.add(grid[i][j]);
        }
      }
      const dirs = [[-1,0],[1,0],[0,-1],[0,1],[-1,-1],[-1,1],[1,-1],[1,1]];
      for (let i = 0; i < 3; i++) {
        for (let j = 0; j < 6; j++) {
          for (const [dx, dy] of dirs) {
            const ni = i + dx, nj = j + dy;
            if (
              ni >= 0 && ni < 3 &&
              nj >= 0 && nj < 6 &&
              grid[i][j] === grid[ni][nj]
            ) {
              messageEl.textContent = t.errorMessage;
              messageEl.style.color = 'red';
              return;
            }
          }
        }
      }

      messageEl.textContent = t.winMessage;
      messageEl.style.color = 'green';
      soundWin.play();
    }

    function reiniciarJogo() {
      messageEl.textContent = '';
      messageEl.style.color = '';
      criarTabuleiro();
      criarPaleta();
    }

    function iniciarJogo() {
      document.getElementById('instructions').style.display = 'none';
      board.style.display   = 'grid';
      palette.style.display = 'flex';
      document.getElementById('btnReiniciar').style.display = 'inline-block';
      document.getElementById('btnInstrucoes').style.display = 'inline-block';
      reiniciarJogo();
      atualizarIdioma();
    }

    function mostrarInstrucoes() {
      const el = document.getElementById('instructions');
      el.style.display = el.style.display === 'block' ? 'none' : 'block';
    }

    function toggleModoNoturno() {
      document.body.classList.toggle('dark-mode');
    }

    function atualizarIdioma() {
      const lang = document.getElementById('lang-select').value;
      const t    = translations[lang];

      document.getElementById('game-title').textContent        = t.title;
      document.getElementById('instructions-title').textContent = t.howToPlay;
      document.querySelectorAll('#instructions-list li')
        .forEach((li, i) => li.textContent = t.instructions[i]);
      document.getElementById('instructions-goodluck').textContent = t.goodLuck;
      document.getElementById('btnStartGame').textContent        = t.startGame;
      document.getElementById('btnReiniciar').textContent        = t.restartGame;
      document.getElementById('btnInstrucoes').textContent       = t.seeInstructions;
      document.getElementById('label-language').textContent      = t.language;
      document.getElementById('btnToggleMode').textContent       = t.toggleMode;

      if (messageEl.textContent === t.winMessage)  messageEl.style.color = 'green';
      if (messageEl.textContent === t.errorMessage) messageEl.style.color = 'red';
    }

    function mudarIdioma() {
      atualizarIdioma();
    }

    document.addEventListener('DOMContentLoaded', atualizarIdioma);
  </script>
</body>
</html>
